name: Validate SuperStrict
on: [workflow_dispatch, workflow_call]

jobs:
  bash-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          repository: '2dengine/sstrict.lua'
          path: 'sstrict.lua'
          ref: 'main'
        
      - name: Lua 5.1 Test
        run: |
          sudo apt -y install lua5.1
          sudo apt -y install lua-filesystem
          sudo apt update
          mkdir "__tmp"
          #if [ -f "sstrict.lua/.github/workflows/scan.lua" ]; then
          #  cat "sstrict.lua/.github/workflows/scan.lua" > "./__tmp/scan.lua"
          #  cat "sstrict.lua/sstrict.lua" > "./__tmp/sstrict.lua"
          #else
          #  cat ".github/workflows/scan.lua" > "./__tmp/scan.lua"
          #  cat ".github/workflows/sstrict.lua" > "./__tmp/sstrict.lua"
          #fi
          lua "./__tmp/scan.lua"
          if test -f "./test.lua"; then
            lua "./test.lua"
          fi
        
      - name: Lua 5.2 Test
        run: |
          sudo apt -y install lua5.2
          sudo apt -y install lua-filesystem
          sudo apt update
          lua "./.github/workflows/scan.lua"
          if test -f "./test.lua"; then
            lua "./test.lua"
          fi

      - name: Lua 5.3 Test
        run: |
          sudo apt -y install lua5.3
          sudo apt -y install lua-filesystem
          sudo apt update
          lua "./.github/workflows/scan.lua"
          if test -f "./test.lua"; then
            lua "./test.lua"
          fi

