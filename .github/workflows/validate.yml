name: Validate SuperStrict
on: [workflow_dispatch, workflow_call]

jobs:
  bash-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Lua 5.1 Test
        run: |
          sudo apt -y install lua5.1
          sudo apt -y install lua-filesystem
          sudo apt update
          mkdir "__tmp"
          curl "https://raw.githubusercontent.com/2dengine/sstrict.lua/refs/heads/main/.github/workflows/scan.lua" -o "./__tmp/scan.lua"
          curl "https://raw.githubusercontent.com/2dengine/sstrict.lua/refs/heads/main/sscript.lua" -o "./__tmp/sscript.lua"

          echo -n "package.path=package.path..';./__tmp/';" | cat - "./__tmp/scan.lua" > "./__tmp/scan2.lua"
          mv "./__tmp/scan2.lua" "./__tmp/scan.lua"
          lua "./__tmp/scan.lua"
          #lua "./.github/workflows/scan.lua"
          if test -f "./test.lua"; then
            lua "./test.lua"
          fi
        
      - name: Lua 5.2 Test
        run: |
          sudo apt -y install lua5.2
          sudo apt -y install lua-filesystem
          sudo apt update
          lua "./.github/workflows/scan.lua"
          if test -f "./test.lua"; then
            lua "./test.lua"
          fi

      - name: Lua 5.3 Test
        run: |
          sudo apt -y install lua5.3
          sudo apt -y install lua-filesystem
          sudo apt update
          lua "./.github/workflows/scan.lua"
          if test -f "./test.lua"; then
            lua "./test.lua"
          fi

